schema:
  name: canonical_event
  version: 1.0.0
  generated_at: '2026-01-24T02:37:11.950296Z'
  description: Canonical event schema used by transform/integrate steps. Supports
    raw ingestion, normalization, and linkage to world_state.observations.
  principles:
  - Events are immutable and append-only.
  - Events carry evidence anchors and uncertainty.
  - Events can reference entities, state variables, and transitions.
  - Normalization preserves original payload (raw) + canonical form.
types:
  Anchor:
    type: object
    required:
    - ref
    - kind
    properties:
      ref:
        type: string
      kind:
        type: string
        enum:
        - file
        - url
        - tool
        - log
        - sensor
        - human_note
        - api
      timestamp:
        type: string
        nullable: true
      excerpt:
        type: string
        nullable: true
  Uncertainty:
    type: object
    required:
    - type
    - confidence
    properties:
      type:
        type: string
        enum:
        - epistemic
        - aleatoric
        - mixed
      confidence:
        type: number
        minimum: 0
        maximum: 1
      notes:
        type: string
        nullable: true
  EntityRef:
    type: object
    required:
    - entity_id
    properties:
      entity_id:
        type: string
      entity_type:
        type: string
        nullable: true
      alias:
        type: string
        nullable: true
event:
  type: object
  required:
  - event_id
  - timestamp
  - source
  - event_type
  - raw
  - canonical
  - anchors
  properties:
    event_id:
      type: string
    timestamp:
      type: string
      description: ISO-8601
    source:
      type: object
      required:
      - kind
      - name
      properties:
        kind:
          type: string
          enum:
          - log
          - api
          - sensor
          - message_bus
          - human
        name:
          type: string
        channel:
          type: string
          nullable: true
        host:
          type: string
          nullable: true
    event_type:
      type: string
      description: normalized type
    severity:
      type: string
      enum:
      - debug
      - info
      - warn
      - error
      - critical
      nullable: true
    tags:
      type: array
      items:
        type: string
      nullable: true
    entity_refs:
      type: array
      items:
        $ref: '#/types/EntityRef'
      nullable: true
    metric:
      type: object
      nullable: true
      properties:
        name:
          type: string
        value:
          type: number
        unit:
          type: string
          nullable: true
        window:
          type: string
          nullable: true
    raw:
      type: object
      description: original payload (unchanged)
    canonical:
      type: object
      description: normalized fields for integration
    anchors:
      type: array
      items:
        $ref: '#/types/Anchor'
    uncertainty:
      $ref: '#/types/Uncertainty'
      nullable: true
    provenance:
      type: object
      nullable: true
      properties:
        transformer:
          type: string
        transform_version:
          type: string
        ruleset_id:
          type: string
          nullable: true
to_observation_event:
  description: Mapping constraints for converting canonical_event â†’ world_state.observations[]
  required_fields:
  - event_id
  - timestamp
  - source
  - raw
  - anchors
  observation_payload_rule: world_state.observations.payload must embed canonical_event.canonical
