mapping:
  name: raw_log_to_observation_event
  version: 1.0.0
  generated_at: '2026-01-24T02:37:11.957061Z'
  description: 'Deterministic mapping spec for transform capability: raw log/message
    → canonical_event → world_state.observations[]'
  inputs:
  - raw_message
  - source_context
  outputs:
  - canonical_event
  - observation_event
rules:
- id: r1_extract_timestamp
  when: raw_message contains ISO-8601 timestamp OR source provides timestamp
  then: canonical_event.timestamp = parsed timestamp else now() with epistemic uncertainty
- id: r2_assign_event_id
  when: always
  then: canonical_event.event_id = stable_hash(source.name + timestamp + raw_message)
- id: r3_classify_event_type
  when: raw_message matches patterns
  then:
  - if contains 'HTTP 5' or '500' -> event_type='http_error'
  - if contains 'timeout' -> event_type='timeout'
  - if contains 'deploy' -> event_type='deployment'
  - else event_type='unclassified'
- id: r4_extract_entity_refs
  when: raw_message contains service/db/host identifiers
  then: entity_refs populated with candidate ids (resolve later via identity-resolution)
- id: r5_build_canonical_payload
  when: always
  then: canonical_event.canonical = {event_type, severity, extracted_fields}; preserve
    raw in canonical_event.raw
- id: r6_emit_observation_event
  when: always
  then:
  - observation.event_id = canonical_event.event_id
  - observation.timestamp = canonical_event.timestamp
  - observation.source = canonical_event.source.kind
  - observation.payload = canonical_event.canonical
  - observation.anchors = canonical_event.anchors
pattern_library:
  severity:
    critical:
    - panic
    - fatal
    - outage
    - SEV0
    error:
    - error
    - exception
    - '500'
    - SEV1
    warn:
    - warn
    - retry
    - degraded
    info:
    - started
    - connected
    - healthy
    debug:
    - trace
    - debug
  entity_ref_hints:
    service:
    - 'svc:'
    - service=
    - app=
    database:
    - 'db:'
    - postgres
    - mysql
    host:
    - host=
    - node=
    - ip=
determinism_contract:
  requirements:
  - Do not drop raw payload.
  - Always produce anchors and uncertainty when inference is used.
  - If classification is ambiguous, set event_type='unclassified' and decrease confidence.
